<html>
  <head>
    <title>Redirected</title>
    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-app.js"></script>

     <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-auth.js"></script>
     <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-database.js"></script>

     <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
     <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>

     <script src="./listfood.js"></script>
     <script src="./addfood.js"></script>

     <link type="text/css" rel="stylesheet" href="./style/stylesheet.css" />
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyCPpZJJ5xm8wevrmdy9zB7k_dc_8wyXww0",
        authDomain: "authtest-af1e0.firebaseapp.com",
        databaseURL: "https://authtest-af1e0.firebaseio.com",
        projectId: "authtest-af1e0",
        storageBucket: "authtest-af1e0.appspot.com",
        messagingSenderId: "483513788016",
        appId: "1:483513788016:web:cf2898648d3b9c15bcb6b5",
        measurementId: "G-936C46KKLS"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var database = firebase.database();
    </script>
  </head>
  <body>
    <div id="intro">
      <h1>Welcome to the login page</h1>
      <p id="display"></p>
    </div>
    <div id="grocerylist"></div>
    <input id="foodadd" type="button" value="Add Food">
    <script>
      // Show grocery list when user is logged in
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          // User is signed in
          $("#display").html(`${user.displayName}'s Grocery List`);
          var listRef = firebase.database().ref(`lists/${user.uid}`);

          // Render grocery list from data
          listRef.once('value', function(snapshot) {
            renderList(snapshot.val(), document.getElementById("grocerylist"));
          });

          function updateGroceryList(food)
          {
            // Get name of new dish and grab a reference in the database
            let dishName = food[0];
            let ingredients = food[1];
            let dishRef = firebase.database().ref(`lists/${user.uid}/${dishName}`);

            // Insert dish in database
            dishRef.set(ingredients);

            // Re-render grocery lists
            firebase.database().ref(`lists/${user.uid}`).once('value').then(function(snapshot) {
              renderList(snapshot.val(), document.getElementById("grocerylist"));
            });
          }

          $("#foodadd").on("click", function(event) {
            renderform(updateGroceryList, document.getElementById("grocerylist"));
          });

        } else {
          $("#display").html("<a href='./index.html'>Sign in</a> to view your grocery list");
        }
      });
    </script>
  </body>
</html>
